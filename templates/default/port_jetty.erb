##############
### Jetty ####
##############
# Port input
# Jetty HTTP
-A FWR -p tcp -m tcp --dport <%=node['jetty']['port'] %> -j ACCEPT
<% if node['jetty']['ssl_port'] and (node['jetty']['ssl_subject'] or node['jetty']['ssl_cert']) %>

# Jetty HTTPS
-A FWR -p tcp -m tcp --dport <%=node['jetty']['ssl_port'] %> -j ACCEPT
<% end %>
<% if node['jetty']['port_forward'] or node['jetty']['ssl_port_forward'] %>

*nat
# Jetty Port forwarding
<%   if node['jetty']['port_forward'] %>
# Jetty HTTP port forward
-A PREROUTING -p tcp --dport <%= node['jetty']['port_forward'] %> -j REDIRECT --to-port <%=node['jetty']['port'] %>
-A OUTPUT -p tcp --dport <%= node['jetty']['port_forward'] %> -j REDIRECT --to-port <%=node['jetty']['port'] %>
<%   end %>
<%   if node['jetty']['ssl_port_forward'] %>
# Jetty HTTPS port forward
-A PREROUTING -p tcp --dport <%= node['jetty']['ssl_port_forward'] %> -j REDIRECT --to-port <%=node['jetty']['ssl_port'] %>
-A OUTPUT -p tcp --dport <%= node['jetty']['ssl_port_forward'] %> -j REDIRECT --to-port <%=node['jetty']['ssl_port'] %>
<%   end %>
<% end %>